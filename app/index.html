<html>

<body onload="avvio()">

  <h1>Cerca Insegnanti</h1>

  <script>

    async function cercaInsegnante() {

      const cont = document.getElementById('container');
      var select_città = document.getElementById('regioni');
      var città = select_città.options[select_città.selectedIndex].textContent;
      var select_materia = document.getElementById('materie');
      var materia = select_materia.options[select_materia.selectedIndex].textContent;
      //console.log(città, materia);
      const payload = {
        città: città,
        materia: materia
      };
      const response = await fetch('http://localhost:3000/get-insegnante', {
        method: "POST",
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      const jsonResponse = await response.json();

      const body = document.getElementById('body-tabella');
      dataHtml = "";

      for (let insegnante of jsonResponse) {
        dataHtml += "<tr><td>" + insegnante.nome + "</td><td>" + insegnante.cognome + "</td><td>" + insegnante.materie + "</td><td>" + insegnante.città + "</td><td>"+ insegnante.telefono + "</td></tr>";
      }
      body.innerHTML = dataHtml;

    }
/////////////////////////////////////////////////////////////////////////////////////
    async function avvio(){

      const select_regioni = document.getElementById('select-regioni');
      const select_materie = document.getElementById('select-materie');

      const payload = {
            città: "città",
            materia: "materia"
        };
      const response = await fetch('http://localhost:3000/get-select', {
            method: "POST",
           
        });

      const jsonResponse = await response.json();
      console.log(jsonResponse);
      var subjects = [];
      var cities = [];
      for(let row of jsonResponse){
        for(let i of row.materie){
          subjects.push(i);
        }
        cities.push(row.città);
      }
      subjects = [... new Set(subjects)];
      cities = [... new Set(cities)];
      console.log(subjects, cities);
      var dataHtml = "<option>---</option>";
      var materieHtml = "<option>---</option>";
      for (let city of cities) {
        dataHtml += "<option>"+city+"</option>" ;
      }
      select_regioni.innerHTML = dataHtml;
      for (let subject of subjects) {
        materieHtml += "<option>"+subject+"</option>" ;
      }
      select_materie.innerHTML = materieHtml;
    }

  </script>

  <div class="regioni">
    <p>Seleziona città:</p>
      <select id = "select-regioni">

      </select>
    </div>
  <div class="materie">
    <p>Seleziona materia:</p>
      <select id = "select-materie">
  
      </select>
    </div>
  <!--///////////////////////////////////////////////////////////////////////////////////////////////////////////////-->
  
    <br>
    <button class='button' onclick="cercaInsegnante()">Cerca Insegnante</button>
  </div>
  <br>
  <hr/>
  <br>
  <table class="tabella" id="tabella">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Cognome</th>
        <th>Materie</th>
        <th>Città</th>
        <th>Numero telefonico</th>
      </tr>
    </thead>

    <tbody id="body-tabella"></tbody>
  </table>
</body>

<style>
  table,
  body {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  td,
  th {
    border: 1px solid #CCCCCC;
    padding: 8px;
  }

  th {
    font-weight: bold;
    text-transform: uppercase;
  }

</style>

</html>